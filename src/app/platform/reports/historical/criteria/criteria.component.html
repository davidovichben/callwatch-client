<form (ngSubmit)="submit()" [formGroup]="formGroup" *ngIf="reportTemplate">
  <p class="mb-3 f-20 blue-text">{{ 'data_filtering' | t }}</p>
  <div class="criterion">
    <span class="d-flex align-items-center">{{ 'show_values_in_date_range' | t }}:</span>
    <app-date-range-picker formGroupName="dates">
      <app-date-range-input formControlName="start" [placeholder]="'start_date' | t" startInput></app-date-range-input>
      <app-date-range-input formControlName="end" [placeholder]="'end_date' | t" endInput></app-date-range-input>
    </app-date-range-picker>
  </div>
  <div class="criterion">
    <span class="d-flex align-items-baseline">{{ 'for_hours_in_day' | t }}:</span>
    <div formArrayName="times">
      <div class="d-flex mb-3" [formGroupName]="i" *ngFor="let control of formGroup.get('times')['controls']; let i = index; let first = first; let last = last">
        <mat-form-field class="mx-3 no-space">
          <mat-label>{{ 'from_hour' | t }}</mat-label>
          <input matInput type="time" formControlName="start">
        </mat-form-field>
        <mat-form-field class="mx-3 no-space">
          <mat-label>{{ 'to_hour' | t }}</mat-label>
          <input matInput type="time" formControlName="end">
        </mat-form-field>
        <div class="d-flex align-items-center">
          <button mat-flat-button type="button" class="ms-1 light-green-btn" (click)="addTime()" *ngIf="last">
            <mat-icon class="f-16">add</mat-icon>
          </button>
          <button mat-flat-button type="button" class="blue-btn" (click)="removeTime(i)" *ngIf="!first">
            <mat-icon class="f-16">remove</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="criterion" formGroupName="weekDays">
    <span>{{ 'days_to_show' | t }}:</span>
    <mat-checkbox class="mx-3" [formControlName]="day" *ngFor="let day of weekDays">{{ day | t }}</mat-checkbox>
  </div>
  <div class="criterion">
    <span>{{ 'phone_numbers' | t }}:</span>
    <mat-form-field class="mx-3 no-space">
      <mat-label>{{ 'calling_number' | t }}</mat-label>
      <input matInput type="text" formControlName="callingNumber">
    </mat-form-field>
    <mat-form-field class="mx-3 no-space">
      <mat-label>{{ 'called_to_number' | t }}</mat-label>
      <input matInput type="text" formControlName="calledNumber">
    </mat-form-field>
  </div>
  <div class="criterion">
    <span>{{ 'abandonment_treatment_time_seconds' | t }}:</span>
    <mat-form-field class="mx-3 no-space">
      <mat-select formControlName="abandonTime">
        <mat-option [value]="time" *ngFor="let time of abandonTimes">{{ time }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div class="criterion">
    <span>{{ 'time_space' | t }}:</span>
    <mat-form-field class="mx-3 no-space">
      <mat-select formControlName="timeSpace">
        <mat-option [value]="timeSpace" *ngFor="let timeSpace of timeSpaces">{{ timeSpace | t }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div class="criterion">
    <span>{{ 'call_types' | t }}:</span>
    <mat-checkbox class="mx-3" formControlName="showExternal">{{ 'show_external_calls' | t }}</mat-checkbox>
    <mat-checkbox class="mx-3" formControlName="showInternal">{{ 'show_internal_calls' | t }}</mat-checkbox>
  </div>
  <div class="criterion">
    <span class="d-flex align-items-baseline">{{ 'data_sorting' | t }}:</span>
    <div formArrayName="sort">
      <div class="d-flex mb-3" [formGroupName]="i" *ngFor="let control of formGroup.get('sort')['controls']; let i = index; let first = first; let last = last">
        <mat-form-field class="mx-3 no-space">
          <mat-label>{{ 'select_column' | t }}</mat-label>
          <mat-select formControlName="column" (valueChange)="sortColumnSelected($event, i)">
            <mat-option *ngIf="i === 0">-------</mat-option>
            <mat-option [value]="column.id" *ngFor="let column of reportTemplate.columns" [disabled]="column.disabled">{{ (column.name | t) }} {{ column.level }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field class="mx-3 no-space">
          <mat-label>{{ 'order' | t }}</mat-label>
          <mat-select formControlName="direction">
            <mat-option [value]="direction.value" *ngFor="let direction of sortDirections">{{ direction.label | t }}</mat-option>
          </mat-select>
        </mat-form-field>
        <div class="d-flex align-items-center">
          <button mat-flat-button type="button" class="ms-1 light-green-btn" (click)="addSortColumn()" *ngIf="last && reportTemplate.columns.length > (i + 1)">
            <mat-icon class="f-16">add</mat-icon>
          </button>
          <button mat-flat-button type="button" class="blue-btn" (click)="removeSortColumn(i)" *ngIf="!first">
            <mat-icon class="f-16">remove</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="criterion">
    <span class="d-flex align-items-center">{{ 'ignore_dates' | t }}:</span>
<!--    <app-date-range-picker formGroupName="ignoreDates">-->
<!--      <app-date-range-input formControlName="start" [placeholder]="'start_date' | t" startInput></app-date-range-input>-->
<!--      <app-date-range-input formControlName="end" [placeholder]="'end_date' | t" endInput></app-date-range-input>-->
<!--    </app-date-range-picker>-->
  </div>
  <p class="mb-3 f-20 blue-text">{{ 'units_to_show' | t }}</p>
  <div class="mb-4">
    <app-unit-select formControlName="units" [units]="units" [multiple]="true" class="w-300p"></app-unit-select>
  </div>
  <div>
    <button mat-flat-button class="blue-btn w-100p" type="submit">{{ 'show_report' | t }}</button>
  </div>
</form>
