<form [formGroup]="formGroup" (ngSubmit)="submit()">
  <div class="form-header">
    <p class="h1" *ngIf="formType === 'acd'">{{ model ? ('edit_acd' | t) : ('add_acd' | t) }}</p>
    <p class="h1" *ngIf="formType === 'extension'">{{ model ? ('edit_extension' | t) : ('add_extension' | t) }}</p>
    <div>
      <button type="button" class="ms-2 btn grey-btn" [routerLink]="['/platform', tableUrl]">{{ 'cancel' | t }}</button>
      <button type="submit" class="btn blue-btn">{{ 'save' | t }}</button>
    </div>
  </div>
  <div class="form-body">
    <div class="mb-4 tabs">
      <a class="tab" [ngClass]="{ active: activeTab === 'general' }" (click)="activeTab = 'general'">{{ 'general' | t }}</a>
      <a class="tab" [ngClass]="{ active: activeTab === 'switchboard' }" (click)="activeTab = 'switchboard'" *ngIf="formType === 'acd'">{{ 'switchboard_settings' | t }}</a>
      <a class="tab" [ngClass]="{ active: activeTab === 'associated' }" (click)="activeTab = 'associated'">{{ formType === 'acd' ? ('associated_extensions' | t) : ('associated_groups' | t) }}</a>
      <a class="tab" [ngClass]="{ active: activeTab === 'callback' }" (click)="activeTab = 'callback'">{{ 'callback' | t }}</a>
    </div>
    <section formGroupName="general" [hidden]="activeTab !== 'general'">
      <div class="row">
        <div class="col-12 col-lg-3" [ngClass]="{ 'mt-3': formType === 'extension', 'pt-1': formType === 'extension' }">
          <mat-form-field>
            <mat-label>{{ formType === 'acd' ? ('group_name' | t) : ('extension_name' | t) }}</mat-label>
            <input matInput type="text" formControlName="name" required>
            <mat-error>{{ errorMessages.required | t }}</mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3" formGroupName="dialNumbers" *ngIf="formType === 'extension'">
          <p class="mb-0 f-14">{{ 'dial_numbers' | t }}</p>
          <div class="d-flex">
            <mat-form-field class="w-50 ps-1">
              <mat-label>{{ 'from' | t }}</mat-label>
              <input matInput type="number" formControlName="from" required>
              <mat-error>{{ errorMessages.required | t }}</mat-error>
            </mat-form-field>
            <mat-form-field class="w-50 pe-1">
              <mat-label>{{ 'until' | t }}</mat-label>
              <input matInput type="number" formControlName="to" required>
              <mat-error>{{ errorMessages.required | t }}</mat-error>
            </mat-form-field>
          </div>
          <p class="alert alert-danger" [@fade]="formGroup.get('general.dialNumbers').errors ? 'active' : 'inactive'">{{ errorMessages.greaterThan | t }}</p>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ formType === 'acd' ? ('group_type' | t) : ('extension_type' | t) }}</mat-label>
            <mat-select formControlName="type" required>
              <mat-option *ngFor="let type of selects.types" [value]="type.id">{{ type.name }}</mat-option>
            </mat-select>
            <mat-error>{{ errorMessages.required | t }}</mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <app-unit-select formControlName="unit" [units]="selects.units" [placeholder]="'select_units' | t"></app-unit-select>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-lg-6">
          <mat-form-field>
            <mat-label>{{ 'description' | t }}</mat-label>
            <textarea rows="8" matInput formControlName="description"></textarea>
          </mat-form-field>
        </div>
      </div>
    </section>
    <section formGroupName="switchboard" [hidden]="activeTab !== 'switchboard'">
      <div class="row mb-3">
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'switchboard' | t }}</mat-label>
            <mat-select formControlName="switchboard" required>
              <mat-option *ngFor="let switchboard of selects.switchboards" [value]="switchboard.id">{{ switchboard.name }}</mat-option>
            </mat-select>
            <mat-error>{{ errorMessages.required | t }}</mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'group_number' | t }}</mat-label>
            <input matInput type="text" formControlName="number" required>
            <mat-error *ngIf="formGroup.get('switchboard.number').errors?.required">{{ errorMessages.required | t }}</mat-error>
            <mat-error *ngIf="formGroup.get('switchboard.number').errors?.exists">{{ 'group_number_uniqueness_error' | t }}</mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'hunt_pilot_number' | t }}</mat-label>
            <input matInput type="text" formControlName="huntPilot">
            <mat-error>{{ 'hunt_uniqueness_error' | t }}</mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'secondary_hunt_pilot_number' | t }}</mat-label>
            <input matInput type="text" formControlName="secondaryHuntPilot">
            <mat-error>{{ 'secondary_hunt_uniqueness_error' | t }}</mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'queue_full_overflow_number' | t }}</mat-label>
            <input matInput type="text" formControlName="queueFullOverflow">
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'max_wait_time_overflow_number' | t }}</mat-label>
            <input matInput type="text" formControlName="maxWaitTime">
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'no_agent_overflow_number' | t }}</mat-label>
            <input matInput type="text" formControlName="noAgentOverflow">
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'no_answer_redirection' | t }}</mat-label>
            <input matInput type="text" formControlName="noAnswerRedirection">
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'busy_sound_redirection' | t }}</mat-label>
            <input matInput type="text" formControlName="busyRedirection">
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-lg-3">
          <mat-checkbox formControlName="isBroadcast">{{ 'is_broadcast' | t }}</mat-checkbox>
        </div>
        <div class="col-12 col-lg-3">
          <mat-checkbox formControlName="hasQueue">{{ 'has_queue' | t }}</mat-checkbox>
        </div>
      </div>
    </section>
    <section [hidden]="activeTab !== 'associated'">
      <app-select-groups formControlName="associated" [items]="formType === 'extension' ? selects.acds : selects.extensions"></app-select-groups>
    </section>
    <section formGroupName="callback" [hidden]="activeTab !== 'callback'">
      <div class="row">
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'dialer_profile' | t }}</mat-label>
            <mat-select formControlName="callback">
              <mat-option *ngFor="let callback of selects.callbacks" [value]="callback.id">{{ callback.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-12 col-lg-3">
          <mat-form-field>
            <mat-label>{{ 'dialer_ivr' | t }}</mat-label>
            <mat-select formControlName="router">
              <mat-option *ngFor="let router of selects.routers" [value]="router.id">{{ router.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="row">
          <div class="col-12 col-lg-3">
            <mat-form-field>
              <mat-label>{{ 'lbl_overflow' | t }}</mat-label>
              <input matInput type="text" formControlName="overflowNumber">
            </mat-form-field>
          </div>
          <div class="col-12 col-lg-3">
            <mat-form-field>
              <mat-label>{{ 'email' | t }}</mat-label>
              <input matInput type="email" formControlName="email">
              <mat-error>{{ errorMessages.email | t }}</mat-error>
            </mat-form-field>
          </div>
          <div class="col-12 col-lg-3">
            <mat-form-field>
              <mat-label>{{ 'dial_outgoing_tel_line' | t }}</mat-label>
              <input matInput type="text" formControlName="dialerCallerID">
            </mat-form-field>
          </div>
        </div>
      </div>
    </section>
  </div>
</form>
