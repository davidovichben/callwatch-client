<div id="selectLabel" #element [ngClass]="{ 'opened': isOpened, 'selected' : selected }" (click)="isOpened = !isOpened">
  <div id="selectLabelBorder" (window:resize)="setCoords()" (window:scroll)="setCoords()"></div>
  <div id="selectLabelCover">
    <span id="placeholder" [@placeholder]="selected && (!multiple || selected.length > 0) ? 'active' : 'inactive'">{{ placeholder }}</span>
    <div id="selectedValue" *ngIf="selected">
      <span *ngIf="!multiple">{{ title }} {{ required ? '* ': '' }}</span>
      <mat-chip-list *ngIf="multiple">
        <mat-chip removable *ngFor="let unit of selected" (removed)="selectUnit(unit, false)">
          <span>{{ unit.name }}</span>
          <i matChipRemove class="la la-times-circle mt-1"></i>
        </mat-chip>
      </mat-chip-list>
    </div>
    <div id="buttons">
      <mat-icon id="resetIcon" (click)="reset($event)" *ngIf="selected?.length > 0">close</mat-icon>
      <mat-icon>expand_more</mat-icon>
    </div>
  </div>
</div>
<div id="dropdown" [ngStyle]="{ 'top': y + 'px', 'width': width + 'px' }" [@slideToggle]="isOpened ? 'active' : 'inactive'">
  <div id="search" class="flex-between">
    <div id="filterInput">
      <input (keyup)="initFilter(filterValueEle.value)" [placeholder]="'search' | t" class="w-100" #filterValueEle>
    </div>
  </div>
  <div id="optionsWrapper">
    <div id="options">
      <ng-container *ngTemplateOutlet="recursiveListTmpl; context:{ list: filteredUnits }"></ng-container>
    </div>
  </div>
</div>
<ng-template #recursiveListTmpl let-list="list">
  <li *ngFor="let unit of list">
    <div class="d-flex align-items-center unit" (click)="unitClicked(unit)">
      <mat-icon class="arrow pointer" [ngClass]="{ 'rotate-side': unit.isToggled, 'fade': !unit.units }" (click)="toggleUnit(unit, $event)">arrow_left</mat-icon>
      <mat-checkbox color="primary" (click)="$event.stopPropagation()" [checked]="unit.checked" (change)="selectUnit(unit, $event.checked)" *ngIf="multiple"></mat-checkbox>
      <div>{{ unit.name }}</div>
    </div>
    <ul *ngIf="unit.units" [ngClass]="{ 'toggled': unit.isToggled }">
      <ng-container *ngTemplateOutlet="recursiveListTmpl; context:{ list: unit.units }"></ng-container>
    </ul>
  </li>
</ng-template>
